

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Species Distribution Modelling with Python &#8212; Topics in Quantitative Ecology and Beyond</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/Species Distribution Modelling';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Introduction" href="Introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="Introduction.html">
  
  
  
  
  
  
    <p class="title logo__title">Topics in Quantitative Ecology and Beyond</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="Introduction.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Species Distribution Modelling with Python</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/twhit1/quant_ecolo" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/Species Distribution Modelling.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Species Distribution Modelling with Python</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-data-and-packages">Import data and packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods">Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#study-area">Study area</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#panthera-onca-occurrence-data">Panthera onca occurrence data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reprojection">Reprojection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-autocorrelation">Spatial autocorrelation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#climate-and-elevation-data">Climate and elevation data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#covariate-histograms">Covariate histograms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">Feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#features-with-major-disconituities">Features with major disconituities</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-analysis">PCA analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collinearity-analysis">Collinearity analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#environmental-envelope">Environmental envelope</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#oneclasssvm-presence-background-models">OneClassSVM &amp; presence-background models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-and-conclusions">Discussion and Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="species-distribution-modelling-with-python">
<h1>Species Distribution Modelling with Python<a class="headerlink" href="#species-distribution-modelling-with-python" title="Permalink to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>Today, a wealth of biodiversity and earth observation data sets, available from sources like the Global Biodiversity Information Facility (GBIF) [1], and WorldClim [24], which are used in this notebook.</p>
<p>Together with the accessibility of cheap computing power and advanced computational modelling tools, the range of applications of datasets like these is broad and growing.</p>
<p>This notebook considers one such application: Species Distribution Modelling. Species Distribution Models (SDMs) link environmental covariates, such as spatial distributions of climate or topographical variables, to spatially-explicit biodiversity data, such as species occurrence records [8, 13, 25].</p>
<p>SDMs have found applications in conservation, ecology, evolution and other fields [22], for purposes like guiding field research, informing conservation strategies and predicting ecological impacts of climate change [8, 23].</p>
<p><strong>What is covered in this notebook?</strong> <br>
Whilst SDM tools seem well-developed in the R programming language [26, 27, 28], I was only able to find one Python package, the companion publication of which notes the lack of Python SDM tools [13].</p>
<p>This notebook aims to present a basic SDM modelling workflow in Python, with example SDMs fitted to a sample of Panthera onca (Jaguar) occurrence observations downloaded from the GBIF, with WorldClim covariates. After presenting the methods used, specifically on data sourcing, preprocessing, and model selection and scoring, I go on to plot and discuss habitat suitability maps before concluding.</p>
</section>
<section id="import-data-and-packages">
<h2>Import data and packages<a class="headerlink" href="#import-data-and-packages" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vector processing</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">shapely</span>

<span class="c1"># Raster processing</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">rasterio.plot</span>
<span class="kn">import</span> <span class="nn">rasterio.features</span>
<span class="kn">import</span> <span class="nn">rasterio.sample</span>
<span class="kn">from</span> <span class="nn">rasterio</span> <span class="kn">import</span> <span class="n">windows</span>

<span class="c1"># Calcs and modelling</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">zscore</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">import</span> <span class="nn">elapid</span> <span class="k">as</span> <span class="nn">ela</span>

<span class="c1"># Visualisation</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">geoplot</span> <span class="k">as</span> <span class="nn">gplt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.formatter.limits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">FIGSIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

<span class="c1"># Practical</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this heading">#</a></h2>
<section id="study-area">
<h3>Study area<a class="headerlink" href="#study-area" title="Permalink to this heading">#</a></h3>
<p>The Jaguar’s global range is mostly limited to the South American continent, though the distribution extends into Central America [29].</p>
<p>To speed up and simplify calculations and plotting, I selected the contiguous part of the South American continent as the study area, shown in the figure below, using a standard ESRI continent shapefile [10]. Reducing the study area in this way is not typical of the SDM workflows referenced in this notebook, but makes sense for an introductory study, as the majority of the Jaguar range is covered, and we don’t have to oversimplify the ecological processes governing movement and dispersal to/from islands.</p>
<p>Note that all plots are shown and calculations performed in projected coordinates. I’m using an equal-area projection with units of metres - see details in the reprojection section.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">WORKING_CRS</span> <span class="o">=</span> <span class="s1">&#39;ESRI:102033&#39;</span>
<span class="n">_sa</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;data/world_continents/&#39;</span><span class="p">)</span>
<span class="n">_sa</span> <span class="o">=</span> <span class="n">_sa</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">WORKING_CRS</span><span class="p">)</span>
<span class="n">SA</span> <span class="o">=</span> <span class="n">_sa</span><span class="p">[</span><span class="n">_sa</span><span class="p">[</span><span class="s1">&#39;CONTINENT&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;South America&#39;</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Contigous SA continent as Shapely</span>
<span class="n">SA</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">geoms</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">area</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># just contiguous continent</span>

<span class="c1"># ...as a Geoseries</span>
<span class="n">SA_geoseries</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">SA</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">_sa</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

<span class="c1"># ...as np coords</span>
<span class="n">SA_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">SA</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># ...as a raster - and store some information describing the reference system and file structure</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/covar/esri_102033/wc2.1_30s_bio_11_South_America.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">SA_mask</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">rasterize</span><span class="p">([</span><span class="n">SA</span><span class="p">],</span> <span class="n">out_shape</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
    <span class="n">nodata_val</span><span class="p">,</span> <span class="n">ref_shape</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="p">,</span> <span class="n">ref_profile</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">nodata</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">profile</span>

<span class="c1"># will write with a null nodata</span>
<span class="n">ref_profile</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;nodata&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGSIZE</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">SA_mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">ref_bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> 
                                          <span class="n">ref_bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> 
                                          <span class="n">ref_bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> 
                                          <span class="n">ref_bounds</span><span class="o">.</span><span class="n">top</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Study Area: Contiguous South American Continent&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/8b90ab6d8187da51a6495d0c5f1f094bef1e25a4e609d43ded7c914289ba4ee0.png" src="../_images/8b90ab6d8187da51a6495d0c5f1f094bef1e25a4e609d43ded7c914289ba4ee0.png" />
</div>
</div>
</section>
<section id="panthera-onca-occurrence-data">
<h3>Panthera onca occurrence data<a class="headerlink" href="#panthera-onca-occurrence-data" title="Permalink to this heading">#</a></h3>
<p>Panthera onca (Jaguar) occurrence data was downloaded from the GBIF, for South America [1].</p>
<p>As WorldClim covariates are used in the next section, which detail large scale climate data for the period 1970 - 2000, the same period should be used for occurrence records.</p>
<p>Using a longer window (1960 - 2010) results in a four-fold increase in the number of records returned from GBIF. I retain the larger dataset under the assumption that averaged climate variables will have changed little on the longer window. For species distribution modelling aimed at studying changing habitat suitability with future climate scenarios, this kind of assumption would not apply.</p>
<p>Basis of record types were filtered to include human and machine observations, and records labelled as “occurrence”, which removed 42 preserved specimen records from the dataset.</p>
<p>As an initial spatial cleaning step, exact geometry duplicates are dropped - this is a crude cleanup of erroneous geometries where the data provider used a centroid or building location (e.g. an lab location) instead of the actual occurrence location, and potentially a couple of good records that genuinely were detected at the same location (within precision). Spatial data quality is examined in more detail below.</p>
<p>There is a much more sophisticated way to do spatial cleaning on GBIF data with the R package CoordinateCleaner [31], with explicit functions to filter on country capitals, country centroids, known herbaria and zoo locations etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retain only columns of interest</span>
<span class="n">occ_data</span> <span class="o">=</span> <span class="n">occ_data</span><span class="p">[[</span><span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="s1">&#39;countryCode&#39;</span><span class="p">,</span> <span class="s1">&#39;decimalLatitude&#39;</span><span class="p">,</span> <span class="s1">&#39;decimalLongitude&#39;</span><span class="p">,</span> <span class="s1">&#39;coordinateUncertaintyInMeters&#39;</span><span class="p">,</span> <span class="s1">&#39;coordinatePrecision&#39;</span><span class="p">,</span><span class="s1">&#39;eventDate&#39;</span><span class="p">,</span> <span class="s1">&#39;basisOfRecord&#39;</span><span class="p">,</span> <span class="s1">&#39;issue&#39;</span><span class="p">]]</span>

<span class="c1"># Set geometry from lat/lon and delete redundant columns</span>
<span class="n">occ_data</span> <span class="o">=</span> <span class="n">occ_data</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;decimalLongitude&#39;</span><span class="p">],</span> 
                                                    <span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;decimalLatitude&#39;</span><span class="p">]),</span>
                                 <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;decimalLongitude&#39;</span><span class="p">,</span> <span class="s1">&#39;decimalLatitude&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Convert to datetime format and filter date range to match Worldclim date range extended by +-10 years</span>
<span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;eventDate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;eventDate&#39;</span><span class="p">])</span>
<span class="n">occ_data</span> <span class="o">=</span> <span class="n">occ_data</span><span class="p">[(</span><span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;eventDate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;01/01/2011&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;eventDate&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;01/01/1960&#39;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data date range: </span><span class="si">{0}</span><span class="s1"> to </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;eventDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;eventDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>

<span class="c1"># Drop exact duplicates on geometry</span>
<span class="n">occ_data</span> <span class="o">=</span> <span class="n">occ_data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span> <span class="c1"># Will do spatial thinning later anyway</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Retain only columns of interest</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">occ_data</span> <span class="o">=</span> <span class="n">occ_data</span><span class="p">[[</span><span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="s1">&#39;countryCode&#39;</span><span class="p">,</span> <span class="s1">&#39;decimalLatitude&#39;</span><span class="p">,</span> <span class="s1">&#39;decimalLongitude&#39;</span><span class="p">,</span> <span class="s1">&#39;coordinateUncertaintyInMeters&#39;</span><span class="p">,</span> <span class="s1">&#39;coordinatePrecision&#39;</span><span class="p">,</span><span class="s1">&#39;eventDate&#39;</span><span class="p">,</span> <span class="s1">&#39;basisOfRecord&#39;</span><span class="p">,</span> <span class="s1">&#39;issue&#39;</span><span class="p">]]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Set geometry from lat/lon and delete redundant columns</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">occ_data</span> <span class="o">=</span> <span class="n">occ_data</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">points_from_xy</span><span class="p">(</span><span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;decimalLongitude&#39;</span><span class="p">],</span> 
<span class="g g-Whitespace">      </span><span class="mi">6</span>                                                     <span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;decimalLatitude&#39;</span><span class="p">]),</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>                                  <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;occ_data&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Spatial accuracy and precision issues could be problematic for developing SDMs. The GBIF website lists several common error sources [32]:</p>
<ol class="arabic simple">
<li><p>Transformation errors</p></li>
<li><p>Value swapping (lat / lon)</p></li>
<li><p>Incorrect negation on lat / lon data</p></li>
<li><p>Zero-padding affecting apparent precision</p></li>
<li><p>Requirements to intentionally blur precision in the case of protection of sensitive species</p></li>
<li><p>Precision on gridded data (e.g. grid centroids listed, potentially without a coordinate uncertainty)</p></li>
</ol>
<p>In addition [33] notes that known coordinate uncertainty values (301,3036,999,9999) should be cleaned, as they represent defaults (e.g. country centroids). However, none of the coordinate uncertainty values in records retrieved here match those values.</p>
<p>With reference to lat / lon data, transformation errors (1.), systematic coordinate swaps (2.), missed or appended negative signs (3.) should be very obvious on plotting the occurrence records on a map, and likely filtered by the clip to study area operation performed below.</p>
<p>Precision issues (4., 5., 6.) are harder to deal with - in fact most records don’t provide coordinate precision and typically a lot of data is lost if this field is filtered out - so the suggestion is not to do so [33].</p>
<section id="reprojection">
<h4>Reprojection<a class="headerlink" href="#reprojection" title="Permalink to this heading">#</a></h4>
<p>Here I’m using an equal-area projection (recommended in for SDMs in [9]), ESRI:102033: Albers equal area conic.</p>
<p>Using equal-area projections in place of geodetic coordiantes is recommended to avoid possible bias, though in practice this has little effect on SDM coefficients [9].</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">occ_data</span> <span class="o">=</span> <span class="n">occ_data</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">WORKING_CRS</span><span class="p">)</span>
<span class="n">occ_data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">occ_data</span><span class="p">,</span> <span class="n">SA</span><span class="p">)</span> <span class="c1"># clip to SA polygon for consistency</span>
<span class="n">occ_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">occ_data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGSIZE</span><span class="p">)</span>
<span class="n">SA_geoseries</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Spatial Distribution of Occurence Records&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/3eeb45ed3a5d7f43325332ec92aec014b8001e784ac2a998d36e388f20070b14.png" src="../_images/3eeb45ed3a5d7f43325332ec92aec014b8001e784ac2a998d36e388f20070b14.png" />
</div>
</div>
</section>
<section id="spatial-autocorrelation">
<h4>Spatial autocorrelation<a class="headerlink" href="#spatial-autocorrelation" title="Permalink to this heading">#</a></h4>
<p>Both covariate and response variables used to build SDMs on single-species occurrence datasets often display autocorrelation properties [6, 15-18].</p>
<p>Whilst spatial autocorrelation due to exogenous (abiotic) factors exists [34] though can be entirely removed with a comprehensive set of environmental covariates. However, endogenous (biotic) factors (which include dispersal, colonial breeding, home-range size, competition, predation etc.) are harder to deal with [14].</p>
<p>Spatial bias is often present in occurrence datasets (particularly those aggregated from multiple studies, or sourced from citizen science repositories) for instance due to accessibility of the sample area: species are sampled near roads, rivers and research stations [15-18, 34].</p>
<p>Combined, these effects lead to bias in SDMs. One approach to tackling this problem is spatial rarefication / thinning of occurrence data; in [6] only one record per 5 square km is allowed. Here points are filtered based on a circle of radius 2.5 km.</p>
<p>There are more sophisticated approaches to handling biases in this scenario, for example thinning occurrence and background points to be equidistant in geographical or environmental space [34], passing weight arrays into SDM fitting procedures, or by spatial block cross-validation [35].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># There&#39;s no built-in geodataframe thinning routine so do this manually</span>

<span class="c1"># Get spatial relations</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">sjoin</span><span class="p">(</span><span class="n">occ_data</span><span class="p">,</span> <span class="n">occ_data</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">occ_data</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mf">2.5e3</span><span class="p">)),</span> 
                       <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                       <span class="n">predicate</span><span class="o">=</span><span class="s1">&#39;within&#39;</span><span class="p">)[[</span><span class="s1">&#39;index_right&#39;</span><span class="p">]]</span>

<span class="c1"># Shuffle</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># For each spatially homogenous group (2.5km radius) compile lists of points to retain and thin</span>
<span class="n">index_groups</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">thin_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
<span class="n">keep_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">left_index</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">index_groups</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">left_index</span> <span class="ow">in</span> <span class="n">thin_list</span><span class="p">):</span>
        <span class="n">keep_list</span> <span class="o">=</span> <span class="n">keep_list</span> <span class="o">|</span> <span class="p">{</span><span class="n">left_index</span><span class="p">}</span>
        <span class="n">thin_list</span> <span class="o">=</span> <span class="n">thin_list</span> <span class="o">|</span>  <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;index_right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">-</span> <span class="p">{</span><span class="n">left_index</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot results of thinning at different scales</span>
<span class="c1"># Set up bboxes to zoom</span>
<span class="n">ex1_bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.7e5</span><span class="p">,</span> <span class="mf">6.8e5</span><span class="p">,</span> <span class="mf">13.5e5</span><span class="p">,</span> <span class="mf">12.0e5</span><span class="p">)</span>
<span class="n">ar</span> <span class="o">=</span> <span class="p">(</span><span class="n">ex1_bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">ex1_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ex1_bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ex1_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ex2_bbox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.1e5</span><span class="p">,</span> <span class="mf">7e5</span><span class="p">,</span> <span class="mf">5.8e5</span><span class="p">)</span>
<span class="n">ex2_bbox</span> <span class="o">=</span> <span class="n">ex2_bbox</span> <span class="o">+</span> <span class="p">(</span><span class="n">ex2_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ar</span><span class="o">*</span><span class="p">(</span><span class="n">ex2_bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ex2_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]),)</span>

<span class="c1"># Marker parameters</span>
<span class="n">base_size</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">thinned_size</span> <span class="o">=</span> <span class="mi">25</span>

<span class="c1"># Figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGSIZE</span><span class="p">)</span>

<span class="c1"># Continental scale</span>
<span class="n">ax1</span><span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">SA_geoseries</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">thin_list</span><span class="p">)]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">base_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">keep_list</span><span class="p">)]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">thinned_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">ex1_bbox</span><span class="p">))</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>

<span class="c1"># Zoom 1</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">SA_geoseries</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">clip_by_rect</span><span class="p">(</span><span class="o">*</span><span class="n">ex1_bbox</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">thin_list</span><span class="p">)]</span><span class="o">.</span><span class="n">clip_by_rect</span><span class="p">(</span><span class="o">*</span><span class="n">ex1_bbox</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">base_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">keep_list</span><span class="p">)]</span><span class="o">.</span><span class="n">clip_by_rect</span><span class="p">(</span><span class="o">*</span><span class="n">ex1_bbox</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">thinned_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">ex1_bbox</span><span class="p">))</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">ex2_bbox</span><span class="p">))</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Zoom 2</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">thin_list</span><span class="p">)]</span><span class="o">.</span><span class="n">clip_by_rect</span><span class="p">(</span><span class="o">*</span><span class="n">ex2_bbox</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">base_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Thinned records&#39;</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">keep_list</span><span class="p">)]</span><span class="o">.</span><span class="n">clip_by_rect</span><span class="p">(</span><span class="o">*</span><span class="n">ex2_bbox</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">thinned_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Retained records&#39;</span><span class="p">)</span>
<span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="o">*</span><span class="n">ex2_bbox</span><span class="p">))</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figlegend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.76</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Effect at Different Spatial Scales of Thinning Occurence Records&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.025</span><span class="p">,</span> <span class="s1">&#39;Axis units in metres, CRS </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">WORKING_CRS</span><span class="p">),</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The high-level spatial distribution of sampling positions remains largely unchanged, but filtering at smaller spatial scales has reduced the dataset by a third.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">occ_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>302
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">occ_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">keep_list</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>194
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">occ_data</span> <span class="o">=</span> <span class="n">occ_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">keep_list</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="climate-and-elevation-data">
<h3>Climate and elevation data<a class="headerlink" href="#climate-and-elevation-data" title="Permalink to this heading">#</a></h3>
<p>Worldclim [24] climate variables were downloaded from <a class="reference external" href="http://worldclim.org">worldclim.org</a>, along with SRTM elevation data, all at 30s spatial resolution.</p>
<p>I start with the same set of variables as used by a Jaguar SDM study [8]:</p>
<ul class="simple">
<li><p>precipitation of coldest quarter,</p></li>
<li><p>precipitation of warmest quarter,</p></li>
<li><p>precipitation seasonality (coefficient of variation),</p></li>
<li><p>annual precipitation,</p></li>
<li><p>mean temperature of wettest quarter,</p></li>
<li><p>mean temperature of driest quarter,</p></li>
<li><p>maximum temperature of warmest period,</p></li>
<li><p>minimum temperature of coldest period,</p></li>
<li><p>temperature season-ality (coefficient of variation), and</p></li>
<li><p>annual mean temperature</p></li>
</ul>
<p>Reprojections were handled outside of this notebook with GDAL.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bio var mappings</span>
<span class="n">bio_vars</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bio_19&#39;</span><span class="p">:</span> <span class="s1">&#39;precipitation of coldest quarter&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;bio_18&#39;</span><span class="p">:</span> <span class="s1">&#39;precipitation of warmest quarter&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bio_15&#39;</span><span class="p">:</span> <span class="s1">&#39;precipitation seasonality (coefficient   of   variation)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bio_12&#39;</span><span class="p">:</span> <span class="s1">&#39;annual precipitation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bio_8&#39;</span><span class="p">:</span> <span class="s1">&#39;mean temperature  of  wettest  quarter&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bio_9&#39;</span><span class="p">:</span> <span class="s1">&#39;mean temperature of driest quarter&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bio_5&#39;</span><span class="p">:</span> <span class="s1">&#39;maximum temperature of warmest period&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bio_6&#39;</span><span class="p">:</span> <span class="s1">&#39;minimum temperature of coldest period&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bio_4&#39;</span><span class="p">:</span> <span class="s1">&#39;temperature season-ality  (coefficient  of  variation)&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bio_1&#39;</span><span class="p">:</span>  <span class="s1">&#39;annual mean temperature&#39;</span><span class="p">,</span>
    <span class="s1">&#39;elev&#39;</span><span class="p">:</span> <span class="s1">&#39;SRTM elevation&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Sample the covariate values at the occurrence coordinates, and also at random coordinates:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bio_samples</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">bio_samples_rand</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">random_coords</span> <span class="o">=</span> <span class="n">SA_geoseries</span><span class="o">.</span><span class="n">sample_points</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span>
                                          <span class="n">method</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
                                          <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span>
<span class="n">random_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">random_coords</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> 
                           <span class="n">random_coords</span><span class="o">.</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># For each biovar get its value at the occurrence record locations and background points locations</span>
<span class="n">bio_var_paths</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">bio_var</span> <span class="ow">in</span> <span class="n">bio_vars</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/covar/esri_102033/*&#39;</span> <span class="o">+</span> <span class="n">bio_var</span> <span class="o">+</span> <span class="s1">&#39;_South*.tif&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bio_var_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">rio_ds</span><span class="p">:</span>
        <span class="n">bio_samples</span><span class="p">[</span><span class="n">bio_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample_gen</span><span class="p">(</span><span class="n">rio_ds</span><span class="p">,</span> 
                                                                          <span class="n">occ_coords</span><span class="p">,</span> 
                                                                          <span class="n">indexes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                                                                          <span class="n">masked</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> 

        <span class="n">bio_samples_rand</span><span class="p">[</span><span class="n">bio_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample_gen</span><span class="p">(</span><span class="n">rio_ds</span><span class="p">,</span> 
                                                                              <span class="n">random_coords</span><span class="p">,</span> 
                                                                              <span class="n">indexes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                                                                              <span class="n">masked</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> 

<span class="c1"># Clean no_data values </span>
<span class="n">bio_sample_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bio_samples</span><span class="p">)</span>
<span class="n">bio_sample_rand_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bio_samples_rand</span><span class="p">)</span>

<span class="n">bio_sample_df</span> <span class="o">=</span> <span class="n">bio_sample_df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">bio_sample_df</span> <span class="o">==</span> <span class="n">nodata_val</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">bio_sample_rand_df</span> <span class="o">=</span> <span class="n">bio_sample_rand_df</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">bio_sample_rand_df</span> <span class="o">==</span> <span class="n">nodata_val</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>This is equivalent to selecting from the underlying covariate distributions, at occurrence observation points.</p>
<section id="covariate-histograms">
<h4>Covariate histograms<a class="headerlink" href="#covariate-histograms" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGSIZE</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">bio_var</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">bio_vars</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">([</span><span class="n">bio_sample_df</span><span class="p">[</span><span class="n">bio_var</span><span class="p">],</span> 
             <span class="n">bio_sample_rand_df</span><span class="p">[</span><span class="n">bio_var</span><span class="p">]],</span> 
            <span class="mi">20</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">],</span>
            <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> 
            <span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="c1">#, cumulative=True)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">bio_var</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span> <span class="s1">&#39;Entire study region&#39;</span><span class="p">,</span> <span class="s1">&#39;At occurence records&#39;</span><span class="p">,],</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.97</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">),)</span>

<span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Covariate Histograms at Occurrence Record Locations and Across the Study Region&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/beb0d3931adb3d2419fcd46939b1a27cd2ae76d5badf1841d23aeb2e546159ff.png" src="../_images/beb0d3931adb3d2419fcd46939b1a27cd2ae76d5badf1841d23aeb2e546159ff.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">FIGSIZE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">FIGSIZE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">fp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bio_var_paths</span><span class="p">,</span> <span class="n">bio_vars</span><span class="p">,</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">output</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mask</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">read_masks</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span> 
                   <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">,</span> 
                   <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref_bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">top</span><span class="p">],</span>
                   <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="c1"># Just for image / display resolution mismatches, does not alter underlying values</span>
                  <span class="p">)</span>
    <span class="n">SA_geoseries</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    
    <span class="c1"># occ_data.plot(ax=ax, markersize=5, color=&#39;k&#39;, marker=&#39;^&#39;, label=&#39;Occurrence records&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">bio_vars</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="c1"># fig.tight_layout()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/9feff2e043b3eceb68ed6e194d6975aaeae7ba683a2e8b4bb0005307325186fd.png" src="../_images/9feff2e043b3eceb68ed6e194d6975aaeae7ba683a2e8b4bb0005307325186fd.png" />
</div>
</div>
</section>
</section>
</section>
<section id="feature-selection">
<h2>Feature selection<a class="headerlink" href="#feature-selection" title="Permalink to this heading">#</a></h2>
<p>Now proceeding with climatic and topographic features as identified above, I’m running an additional feature selection routine as outlined in [6], which entails testing pairwise Spearman rank values, and for each pair where r &gt; 0.8, discarding the feature with the lower PCA loading.</p>
<p>For SDM applications, it’s also possible to assess histogram shape to aid in feature selection, with normally distributed or skewed bioclimatic distributions corresponding to relevant covariates, and no pattern or truncated histograms being irrelevant [11].</p>
<section id="features-with-major-disconituities">
<h3>Features with major disconituities<a class="headerlink" href="#features-with-major-disconituities" title="Permalink to this heading">#</a></h3>
<p>Due to calculation methodologies [25], some WorldClim variables show major discontinuities, which are visible in the continent-level plots above and will therefore be removed ([25] notes 84 publications taking such an approach)).</p>
<p>Note that bio_8 and bio_9 are highly correlated with elevation, the latter having a higher PCA loading, and therefore these variables would be dropped in the following feature selection process regardless.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bio_8&#39;</span><span class="p">,</span> <span class="s1">&#39;bio_9&#39;</span><span class="p">,</span> <span class="s1">&#39;bio_18&#39;</span><span class="p">,</span> <span class="s1">&#39;bio_19&#39;</span><span class="p">]</span>

<span class="n">bio_sample_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bio_sample_rand_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">[</span><span class="n">bio_vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_drop</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;mean temperature  of  wettest  quarter&#39;,
 &#39;mean temperature of driest quarter&#39;,
 &#39;precipitation of warmest quarter&#39;,
 &#39;precipitation of coldest quarter&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="pca-analysis">
<h3>PCA analysis<a class="headerlink" href="#pca-analysis" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bio_sample_rand_df_norm</span> <span class="o">=</span> <span class="n">bio_sample_rand_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>
<span class="n">base_pca</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">decomposition</span><span class="o">.</span><span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">base_pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">bio_sample_rand_df_norm</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Percentage of variance explained by PC1, PC2 and PC3 respectively:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">base_pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Percentage of variance explained by PC1, PC2 and PC3 respectively:
[0.58807759 0.18920598 0.16364351]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">pc_pair</span> <span class="ow">in</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]:</span> <span class="c1">#, [1, 3]]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">base_pca</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span> <span class="p">[</span><span class="n">pc_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pc_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">base_pca</span><span class="o">.</span><span class="n">explained_variance_</span><span class="p">[[</span><span class="n">pc_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pc_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]),</span> 
                             <span class="n">bio_sample_rand_df_norm</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;PCA </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pc_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PCA </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pc_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/79410b550cd18e8a0d8f7e9af546ffc2b695259dbabd4d47923b1188c3fe40a2.png" src="../_images/79410b550cd18e8a0d8f7e9af546ffc2b695259dbabd4d47923b1188c3fe40a2.png" />
<img alt="../_images/31d750072a54c3ba6148e92fc492fd509a376c4072feb1fa88e081f9db4024d1.png" src="../_images/31d750072a54c3ba6148e92fc492fd509a376c4072feb1fa88e081f9db4024d1.png" />
</div>
</div>
</section>
<section id="collinearity-analysis">
<h3>Collinearity analysis<a class="headerlink" href="#collinearity-analysis" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">bio_sample_rand_df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;spearman&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tick_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">tick_pos</span><span class="p">,</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">tick_pos</span><span class="p">,</span> <span class="n">corr_matrix</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/e77f2d37be170809a5cef0136a2066939f2c3e3e4b1b3c763b9871d839162b51.png" src="../_images/e77f2d37be170809a5cef0136a2066939f2c3e3e4b1b3c763b9871d839162b51.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_pairs</span> <span class="o">=</span> <span class="p">(</span><span class="n">corr_matrix</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()[</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
<span class="n">corr_pairs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pair</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">corr_pairs</span><span class="p">[</span><span class="n">corr_pairs</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">corr_pairs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;bio_8&#39;, &#39;bio_1&#39;),
 (&#39;bio_9&#39;, &#39;bio_6&#39;),
 (&#39;bio_9&#39;, &#39;bio_1&#39;),
 (&#39;bio_6&#39;, &#39;bio_1&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">bio_sample_rand_df</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_ha</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Pairwise Covariate Scatter Plots (Before Feature Selection)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/31dac74bb14208a613bbcc8e98a6b9a5e056d805a74b55aa32c8b14ace69be74.png" src="../_images/31dac74bb14208a613bbcc8e98a6b9a5e056d805a74b55aa32c8b14ace69be74.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">covar_contributions</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">bio_sample_rand_df_norm</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> 
                               <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">base_pca</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">base_pca</span><span class="o">.</span><span class="n">explained_variance_</span><span class="p">),</span> 
                                              <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">display</span><span class="p">(</span><span class="n">covar_contributions</span><span class="p">)</span>
<span class="n">to_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pair</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">covar_contributions</span><span class="p">[</span><span class="n">x</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">corr_pairs</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;bio_15&#39;: 0.9753554385263389,
 &#39;bio_12&#39;: 0.9325460652765638,
 &#39;bio_5&#39;: 0.9729945188704008,
 &#39;bio_6&#39;: 0.9846247561146291,
 &#39;bio_4&#39;: 0.9776014539395527,
 &#39;bio_1&#39;: 0.9902779979490426,
 &#39;elev&#39;: 0.955839640126238}
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">bio_sample_rand_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_ha</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Pairwise Covariate Scatter Plots (After Feature Selection)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Drop those columns in relevant data structures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_drop</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;bio_6&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bio_sample_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">[</span><span class="n">bio_vars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">to_drop</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;minimum temperature of coldest period&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this heading">#</a></h2>
<section id="environmental-envelope">
<h3>Environmental envelope<a class="headerlink" href="#environmental-envelope" title="Permalink to this heading">#</a></h3>
<p>Here I run a simple envelope model similar to BIOCLIM [7], in which the minimal rectilinear envelope in covariate space is established with reference to covariate values at occurrence record locations.</p>
<p>This method is sensitive to outliers, so we can look at a percentiles of the climatic profile corresponding to proportions of occurrence records included [36]. Here I calculate the “full” range envelope (corresponding to all occurrence locations) and also a “core” range envelope [11] corresponding to the 5th to 95th percentiles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">range_distribution</span> <span class="o">=</span> <span class="n">bio_sample_df</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">range_distribution</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bio_15</th>
      <th>bio_12</th>
      <th>bio_5</th>
      <th>bio_6</th>
      <th>bio_4</th>
      <th>bio_1</th>
      <th>elev</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.00</th>
      <td>13.704205</td>
      <td>504.0</td>
      <td>11.400000</td>
      <td>3.000000</td>
      <td>18.355698</td>
      <td>7.362500</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>0.05</th>
      <td>17.026096</td>
      <td>1191.0</td>
      <td>29.600000</td>
      <td>8.800000</td>
      <td>42.711143</td>
      <td>20.312500</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>0.95</th>
      <td>71.629951</td>
      <td>3286.0</td>
      <td>32.900002</td>
      <td>21.400000</td>
      <td>361.791382</td>
      <td>26.316668</td>
      <td>527.0</td>
    </tr>
    <tr>
      <th>1.00</th>
      <td>119.477875</td>
      <td>6703.0</td>
      <td>35.700001</td>
      <td>22.799999</td>
      <td>364.601013</td>
      <td>27.833334</td>
      <td>3617.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Each pixel on the entire study area can then be examined with reference to these bounds, for each covariate.</p>
<p>We then have a choice how to accept or reject each pixel - as some covariates may be in the range evelope, whilst others may not. Clearly a pixel for which all covariates fall inside or outside the range envelope would be accepted or rejected respectively.</p>
<p>For pixels with mixed results, we can take the intersection, average or union of covariate pass/fail values for each pixel to create the surface range maps [13] - here the intersection is taken, which is a strong constraint.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ref_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">core_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ref_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

<span class="n">bio_var_paths</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># REDEFINE to be just those of interest</span>
<span class="k">for</span> <span class="n">bio_var</span> <span class="ow">in</span> <span class="n">range_distribution</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/covar/esri_102033/*&#39;</span> <span class="o">+</span> <span class="n">bio_var</span> <span class="o">+</span> <span class="s1">&#39;_South*.tif&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bio_var_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">full_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">full_range</span><span class="p">,</span> <span class="p">(</span><span class="n">values</span> <span class="o">&gt;=</span> <span class="n">range_distribution</span><span class="p">[</span><span class="n">bio_var</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.0</span><span class="p">])),</span> 
                                  <span class="p">(</span><span class="n">values</span> <span class="o">&lt;=</span> <span class="n">range_distribution</span><span class="p">[</span><span class="n">bio_var</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">1.0</span><span class="p">])</span>
                                <span class="p">)</span>
                                              
    <span class="n">core_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">core_range</span><span class="p">,</span> <span class="p">(</span><span class="n">values</span> <span class="o">&gt;=</span> <span class="n">range_distribution</span><span class="p">[</span><span class="n">bio_var</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.05</span><span class="p">])),</span> 
                                  <span class="p">(</span><span class="n">values</span> <span class="o">&lt;=</span> <span class="n">range_distribution</span><span class="p">[</span><span class="n">bio_var</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mf">0.95</span><span class="p">])</span>
                                <span class="p">)</span>


<span class="c1"># Mask to study area</span>
<span class="n">full_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">full_range</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span> <span class="n">SA_mask</span><span class="p">)</span>
<span class="n">core_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">core_range</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span> <span class="n">SA_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="o">.</span><span class="n">get_bad</span><span class="p">(),</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)])</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">FIGSIZE</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">full_range</span> <span class="o">+</span> <span class="n">core_range</span><span class="p">,</span> 
          <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
          <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
          <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="c1"># Just for image / display resolution mismatches, does not alter underlying values</span>
          <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref_bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">top</span><span class="p">])</span>

<span class="n">SA_geoseries</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">occ_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Occurrence records&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$\it{Panthera\ onca}$ Range Envelopes&#39;</span><span class="p">)</span>

<span class="n">range_legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Full range: [0%, 100%] profile&#39;</span><span class="p">),</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">colors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Core range: [5%, 95%] profile&#39;</span><span class="p">)]</span>



<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">range_legend</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.15</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Note that the full range includes the core range (is the union of blue regions in figure).</p>
<p>Repeat analysis using out-the-box equivalent and check consistency:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">envelope_ela</span>  <span class="o">=</span> <span class="n">ela</span><span class="o">.</span><span class="n">NicheEnvelopeModel</span><span class="p">(</span><span class="n">percentile_range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">overlay</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>
<span class="n">envelope_ela</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">bio_sample_df</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bio_sample_df</span><span class="p">)))</span>

<span class="n">_temp_path</span> <span class="o">=</span> <span class="s1">&#39;data/models/ela_niche_envelope.tif&#39;</span>
<span class="n">ela</span><span class="o">.</span><span class="n">apply_model_to_rasters</span><span class="p">(</span><span class="n">envelope_ela</span><span class="p">,</span> <span class="n">bio_var_paths</span><span class="p">,</span> <span class="n">_temp_path</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># and read into memory</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">_temp_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">ela_niche</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>My manual range envelope and the ELAPID “out-the-box” version are identical:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">ela_niche</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span> <span class="n">SA_mask</span><span class="p">)</span> <span class="o">-</span> <span class="n">full_range</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/models/manual_niche_envelope.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">ref_profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">full_range</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">ref_profile</span><span class="p">[</span><span class="s1">&#39;dtype&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">full_range</span> <span class="o">=</span> <span class="n">full_range</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

<span class="c1"># Delete memory-heavy vars not used in further computation</span>
<span class="k">del</span> <span class="n">values</span><span class="p">,</span> <span class="n">core_range</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="oneclasssvm-presence-background-models">
<h3>OneClassSVM &amp; presence-background models<a class="headerlink" href="#oneclasssvm-presence-background-models" title="Permalink to this heading">#</a></h3>
<p>In this section several SDMs are compiled based on the occurrence datasets, randomly generated background coordinates, and the selected abiotic covariates.</p>
<p>The study area is reduced to the full extent of the surface range envelope computed in the previous section, which can reduce overfitting [13].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##### First generate background points #####</span>
<span class="c1"># Get surface range envelope (new study area)</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;data/models/manual_niche_envelope.tif&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rio_ds</span><span class="p">:</span>
    <span class="n">_full_range</span> <span class="o">=</span> <span class="n">rio_ds</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">envelope_geometry</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">shapes</span><span class="p">(</span><span class="n">_full_range</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">rio_ds</span><span class="o">.</span><span class="n">transform</span><span class="p">))</span>
    <span class="n">full_range</span> <span class="o">=</span> <span class="n">_full_range</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">_full_range</span>
    
<span class="n">envelope_geoseries</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span>
                                        <span class="p">[(</span><span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">entity</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span> <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">envelope_geometry</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                                    <span class="p">),</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">ref_profile</span><span class="p">[</span><span class="s1">&#39;crs&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Background points are generated as a random sample on that area. Seed 10,000 points [4, 5, 16], and sample covariates at those points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">background_coords</span> <span class="o">=</span> <span class="n">envelope_geoseries</span><span class="o">.</span><span class="n">sample_points</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span>
<span class="n">background_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">background_coords</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">background_coords</span><span class="o">.</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="n">bio_sample_background</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">bio_var</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bio_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">bio_var_paths</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">rio_ds</span><span class="p">:</span>
        <span class="n">bio_sample_background</span><span class="p">[</span><span class="n">bio_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rasterio</span><span class="o">.</span><span class="n">sample</span><span class="o">.</span><span class="n">sample_gen</span><span class="p">(</span><span class="n">rio_ds</span><span class="p">,</span> 
                                                                  <span class="n">background_coords</span><span class="p">,</span> 
                                                                  <span class="n">indexes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                                                                  <span class="n">masked</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> 
<span class="n">bio_sample_background_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bio_sample_background</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now set up features and targets, scikit-learn-style. Normalize covariates for model development.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##### Set up test, train features and targets #####</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">bio_sample_df</span><span class="p">,</span> <span class="n">bio_sample_background_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">bio_sample_df</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">bio_sample_background_df</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>

<span class="c1"># Normalization</span>
<span class="n">X_mean</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">X_std</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">norm_covs</span><span class="p">(</span><span class="n">cov</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">cov</span> <span class="o">-</span> <span class="n">X_mean</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">X_std</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
<span class="n">X_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">X_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">X_std</span> 
</pre></div>
</div>
</div>
</div>
<p>Now define the models: I am using four classes of model, two with multiple parameter sets.</p>
<p>OneClassSVM is an unsupervised outlier detection model, applied in a scikit-learn tutorial [3] as a density estimator trained on presence-only data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">svm_1cl</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">OneClassSVM</span><span class="p">(</span><span class="n">nu</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;rbf&quot;</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>MaxEnt is also a density estimator, though it uses presence/background data. It is used widely in the SDM literature [20, 36]; here a standard implementation is used [13], with a variety of values for the regularization parameter (beta): [16] suggests that beta should be empirically found. I use a similar set of beta values to those used in [20].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_ent_model</span> <span class="o">=</span> <span class="p">[</span><span class="n">ela</span><span class="o">.</span><span class="n">MaxentModel</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s1">&#39;cloglog&#39;</span><span class="p">,</span> <span class="n">beta_multiplier</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span> <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>LogisticRegression is a type of Generalized Linear Model (GLM) with a logit link function. GLMs (and also Generalized Additive Models (GAMs)) are very popular SDM approaches [36].</p>
<p>In general, GLMs/GAMs can be used with background data instead of absence/pseudo-absence but requires case-control design [36, 37]. This is difficult in practice - especially in Python with scikit-learn, because it requires modification of the underlying logistic function to include a correction term based on the proportions of occupied and unoccupied locations in the study area, which is rarely known [37]. Therefore this model (and in fact the others) are making relative predictions about species presence, instead of outputting a direct probability of species presence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_classifier</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegression</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>RandomForest is a tree-based model, another popular class of SDM approaches. Here it’s implemented as in [2, 19]. Note that RFs are sensitive to class imbalance &amp; overlap, both of which are present here by default due to the requirement that background points fully sample the study area. There are several ways to deal with this issue [19], though these methods are beyond the scope of this notebook - here I just use a standard parameter of the scikit-learn RandomForest class to weight the samples based on class prevalence in the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf_classifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">sklearn</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">),</span> <span class="c1"># Using gini (this is the default), and 500 trees as suggested in [19]</span>
                <span class="n">sklearn</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;gini&#39;</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<p>One of the out-the-box models (MaxEnt) doesn’t behave with scikit-learn scoring, so I’m implementing a cross validation routine manually here.</p>
<p>The area under the curve (AUC) of the receiver operating characteristic (ROC) is a measure of the performance of binary classifiers and takes values in the range [0.5, 1]. The measure is commonly used to assess performance of SDMs, often alongside a threshold-dependent scorer (e.g. True Skill Statistic, TSS) [19, 38].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">max_ent_model</span><span class="p">,</span> <span class="n">svm_1cl</span><span class="p">,</span> <span class="o">*</span><span class="n">rf_classifier</span><span class="p">,</span> <span class="n">lr_classifier</span><span class="p">]</span>

<span class="c1"># Assess model performance</span>
<span class="k">def</span> <span class="nf">cross_validate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scorers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nfolds</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">model</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="p">:</span> <span class="p">{</span><span class="n">scorer</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span> <span class="k">for</span> <span class="n">scorer</span> <span class="ow">in</span> <span class="n">scorers</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfolds</span><span class="p">):</span>    
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>        
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;predict_proba&#39;</span><span class="p">):</span>
                <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># needs to be ordered to ensure the set of probabilities corresponding to the positive target is taken</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;decision_function&#39;</span><span class="p">):</span> <span class="c1"># this is a 1-class SVM style model</span>
                <span class="n">indexer</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_train</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="c1"># Single class estimation, do not include background points</span>
                <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">indexer</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">indexer</span><span class="p">])</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">scorer</span> <span class="ow">in</span> <span class="n">scorers</span><span class="p">:</span>
                <span class="n">scores</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()][</span><span class="n">scorer</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">nfolds</span><span class="p">)</span> <span class="o">*</span> <span class="n">scorer</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">scores</span>
        

<span class="n">test_scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">X_norm</span><span class="p">,</span> 
                             <span class="n">y</span><span class="p">,</span>
                             <span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> 
                             <span class="n">scorers</span><span class="o">=</span><span class="p">[</span><span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AUC scores for all models are as follows:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Filter for the best performing model in each model family - but keep the best and worst MaxEnt models for comparison.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_models</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">model_full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">model_full_name</span> <span class="ow">in</span> <span class="n">test_scores</span><span class="o">.</span><span class="n">keys</span><span class="p">()]))</span>
<span class="n">best_models</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">base_model</span> <span class="ow">in</span> <span class="n">base_models</span><span class="p">:</span>
    <span class="n">results_set</span> <span class="o">=</span> <span class="p">[(</span><span class="n">model</span><span class="p">,</span><span class="n">score</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">score</span><span class="p">),</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">models</span><span class="p">)</span>  <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">base_model</span><span class="p">)]</span>
    <span class="n">best_result</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results_set</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;roc_auc_score&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">best_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">best_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="s1">&#39;Maxent&#39;</span> <span class="ow">in</span> <span class="n">base_model</span><span class="p">:</span> <span class="c1"># Also store worst model for comparison</span>
        <span class="n">worst_result</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">results_set</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;roc_auc_score&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">best_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">worst_result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">best_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">worst_result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Now train on full dataset, and run predictions on the full study area. This is computationally intensive so I’m using windowed reading and writing functionality from rasterio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">best_models</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_norm</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Apply to full continent using windowed read</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">bio_var_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">feature_windows</span> <span class="o">=</span> <span class="p">[</span><span class="n">_wind</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_wind</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">block_windows</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">feature_windows</span> <span class="o">=</span> <span class="p">[</span><span class="n">windows</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">feature_windows</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_windows</span><span class="p">),</span> <span class="n">n</span><span class="p">)]</span>
<span class="n">write_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;data/models/</span><span class="si">{}</span><span class="s1">.tif&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">best_models</span><span class="p">]</span>
<span class="n">write_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">ref_profile</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">write_paths</span><span class="p">]</span>

<span class="c1"># Start off by tagging the new datasets with the model score</span>
<span class="k">for</span> <span class="n">ds</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">write_datasets</span><span class="p">,</span> <span class="n">best_scores</span><span class="p">):</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">update_tags</span><span class="p">(</span><span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">feature_window</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">feature_windows</span><span class="p">):</span>
    <span class="n">row_slice</span><span class="p">,</span> <span class="n">col_slice</span> <span class="o">=</span> <span class="n">feature_window</span><span class="o">.</span><span class="n">toslices</span><span class="p">()</span>
    <span class="n">_reads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_masks</span> <span class="o">=</span> <span class="p">[</span><span class="n">full_range</span><span class="p">[</span><span class="n">row_slice</span><span class="p">,</span> <span class="n">col_slice</span><span class="p">]]</span> <span class="c1"># only compute where necessary</span>
    
    <span class="c1"># Get the covariates in this window</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bio_var_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bio_var_paths</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">bio_var_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">_reads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norm_covs</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">feature_window</span><span class="p">),</span> <span class="n">i</span><span class="p">))</span> <span class="c1"># Models are trained on normalised inputs, so predictions must be generated on the same</span>
            <span class="n">_masks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read_masks</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">feature_window</span><span class="p">))</span>    
    <span class="n">_reads</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">_reads</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>      
    <span class="n">_masks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">_masks</span><span class="p">)</span>

    <span class="c1"># Run each model prediction and write to file</span>
    <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">best_models</span><span class="p">,</span> <span class="n">write_datasets</span><span class="p">):</span>
        <span class="n">_output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">_masks</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">_output</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">~</span><span class="n">_masks</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;predict_proba&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># needs to be ordered to ensure the set of probabilities corresponding to the positive target is taken</span>
                <span class="n">_output</span><span class="p">[</span><span class="n">_masks</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">_reads</span><span class="p">[</span><span class="n">_masks</span><span class="p">])[:,</span> <span class="mi">1</span><span class="p">]</span>
            
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;decision_function&#39;</span><span class="p">):</span>
                <span class="n">_output</span><span class="p">[</span><span class="n">_masks</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">_reads</span><span class="p">[</span><span class="n">_masks</span><span class="p">])</span>

        <span class="c1"># Save results</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_output</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">feature_window</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    
<span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">write_datasets</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>And now let’s look at the suitabiltiy distributions for the best models, starting with envelope and density estimation models:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in vars from here so that the model does not have to be re-run every time</span>
<span class="n">_res_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;data/models/*.tif&#39;</span><span class="p">)</span>
<span class="n">suit_paths</span> <span class="o">=</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_res_paths</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;envelope&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;OneClassSVM&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="p">)]</span>
<span class="n">suit_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">suit_paths</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">env_models</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">FIGSIZE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FIGSIZE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">env_models</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Envelope membership&#39;</span><span class="p">,</span> <span class="s1">&#39;Distance to SVM decision boundary&#39;</span><span class="p">]</span>
<span class="n">cmaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="o">.</span><span class="n">get_over</span><span class="p">()]),</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">]</span>
<span class="n">norms</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Surface Range Envelope&#39;</span><span class="p">,</span> <span class="s1">&#39;One Class SVM&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">env_paths</span><span class="p">,</span> <span class="n">env_models</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">())):</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">output</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">tags</span><span class="p">()[</span><span class="s1">&#39;score&#39;</span><span class="p">])[</span><span class="s1">&#39;roc_auc_score&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> 
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cmaps</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> 
                   <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref_bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">top</span><span class="p">],</span>
                   <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="c1"># Just for image / display resolution mismatches, does not alter underlying values</span>
                   <span class="n">norm</span><span class="o">=</span><span class="n">norms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">SA_geoseries</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">model_base_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">params_name</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span> <span class="k">else</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="p">((</span><span class="s1">&#39;params: &#39;</span> <span class="o">+</span> <span class="n">params_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">params_name</span> <span class="k">else</span> <span class="s1">&#39;default sklearn params&#39;</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.10</span><span class="p">,</span> <span class="s1">&#39;ROC AUC score: &#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>And also the models which produce probability-style outputs:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">env_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">_res_paths</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">suit_paths</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;ela&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="p">)]</span> <span class="c1"># And ignore the elapid model, as it is the same as the manual envelope</span>
<span class="n">env_models</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">env_paths</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">suit_models</span><span class="p">)</span> <span class="o">//</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">FIGSIZE</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">FIGSIZE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">suit_models</span><span class="p">)</span> <span class="o">//</span> <span class="o">-</span><span class="mi">2</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">fp</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">suit_paths</span><span class="p">,</span> <span class="n">suit_models</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">output</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">tags</span><span class="p">()[</span><span class="s1">&#39;score&#39;</span><span class="p">])[</span><span class="s1">&#39;roc_auc_score&#39;</span><span class="p">]</span>
    
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> 
                   <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> 
                   <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref_bounds</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">bottom</span><span class="p">,</span> <span class="n">ref_bounds</span><span class="o">.</span><span class="n">top</span><span class="p">],</span>
                   <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="c1"># Just for image / display resolution mismatches, does not alter underlying values</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">SA_geoseries</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">model_base_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">params_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">model_base_name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="p">((</span><span class="s1">&#39;params: &#39;</span> <span class="o">+</span> <span class="n">params_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">params_name</span> <span class="k">else</span> <span class="s1">&#39;default sklearn params&#39;</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.10</span><span class="p">,</span> <span class="s1">&#39;ROC AUC score: &#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Habitat Suitability Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/8085773c0f5dd5b5944fdcd10ca534834c3da79905e54f87014fac3bbea340f5.png" src="../_images/8085773c0f5dd5b5944fdcd10ca534834c3da79905e54f87014fac3bbea340f5.png" />
</div>
</div>
<p>I’m using the term habitat suitability for the output, as although all these models (with the exception of SVM) are outputting a probability measure, they were not trained on true absence data and instead on presences and background points.</p>
<p>The OneClassSVM output can be interpreted similarly (as a suitability - though it’s closer to a observation density measure). For clarity - as there are negative values, and the output is not in [0, 1] - it’s labelled ‘distance to decision boundary’ here, which is the statistical interpretation of the output.</p>
<p>For the bioclimatic envelope, the output is binary, as described in the previous section.</p>
</section>
</section>
<section id="discussion-and-conclusions">
<h2>Discussion and Conclusions<a class="headerlink" href="#discussion-and-conclusions" title="Permalink to this heading">#</a></h2>
<p>The main objective here was to show an end-to-end SDM workflow in Python. Due to lack of support for SDM work in the Python language, this notebook was lengthier and more involved than an equivalent in R, with the benefit of perhaps being more explicit, with relatively little in the way of hidden computations.</p>
<p>Looking at the SDM results, ROC AUC scores are generally high, with the highest scoring models assigning high suitabilities to localities corresponding to occurrence records, for which there could be several explanations. This looks like overfitting, perhaps due to insufficient correction of spatial bias in the underlying datasets.</p>
<p>Spatial thinning of occurrence data within 5km of other observations is not actually very effective, and often performs poorly, particularly with low sample prevalence [15]. We can also expect our accuracy measures to be overinflated in spatially autocorrelated datasets [34]. As mentioned already, an approach like spatial block cross validation could be used to alleviate overfitting [35]. However, [39] concludes that care should be taken to correct presence-background SDMs without independent test data.</p>
<p>The selection of background points should also be considered; is 10,000 really enough to fully sample the conditions on an entire continent with covariates sampled at 30s resolution (around 1km at the equator)? In search of spatial bias corrections, we may throw away valuable information in occurrence datasets; refactoring the background point selection method could be a better path to take - and there are several options (environmentally, spatially stratified) [4], and weighting sampling selection of background points such that spatial bias is similar in both the occurrence dataset and background point dataset [39].</p>
<p>Finally, on the applicability of SDMs developed on abiotic data, it should be said that no explicit allowance is made for biotic interactions (e.g. competition, movement, dispersal), which may occur at spatial scales much larger than the grid resolution of this study [30]. For instance, [21] suggests that SDMs should be combined with dispersal constraint information and species interaction data for broad-scale mapping of species distributions. However, traditionally, most SDM studies have not incorporated biotic factors due to lack of “<em>a priori</em> knowledge on interspecific interactions”, though biotic information can be included for instance by adding other species distributions as covariates [30].</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="http://GBIF.org">GBIF.org</a>. GBIF Occurrence Download.  <a class="reference external" href="https://doi.org/10.15468/dl.kwbc6x">https://doi.org/10.15468/dl.kwbc6x</a> [Accessed 11/01/2024].</p></li>
<li><p>Furman D. A Brief Introduction to Species Distribution Models in Python. <a class="reference external" href="https://daniel-furman.github.io/Python-species-distribution-modeling/">https://daniel-furman.github.io/Python-species-distribution-modeling/</a> [Accessed 11/01/2024].</p></li>
<li><p>Prettenhofer P, Vanderplas J. Species Distribution Modelling (Scikit-Learn examples). <a class="reference external" href="https://scikit-learn.org/stable/auto_examples/applications/plot_species_distribution_modeling.html">https://scikit-learn.org/stable/auto_examples/applications/plot_species_distribution_modeling.html</a> [Accessed  11/01/2024].</p></li>
<li><p>Barbet-Massin M, Jiguet F, Albert CH and Thuiller W. Selecting Pseudo-Absences for Species Distribution Models: How, Where and How Many? Methods in Ecology and Evolution. 2012; 3(2): 327-338. <a class="reference external" href="https://doi.org/10.1111/j.2041-210X.2011.00172.x">https://doi.org/10.1111/j.2041-210X.2011.00172.x</a>.</p></li>
<li><p>Biosecurity Commmons. Maxent SDM Explained. <a class="reference external" href="https://support.biosecuritycommons.org.au/support/solutions/articles/6000262266-maxent-sdm-explained">https://support.biosecuritycommons.org.au/support/solutions/articles/6000262266-maxent-sdm-explained</a> [Accessed 12/01/2024].</p></li>
<li><p>Xie C, Chen L, Li M, Jim CY, Liu D. BIOCLIM Modeling for Predicting Suitable Habitat for Endangered Tree Tapiscia sinensis (Tapisciaceae) in China. Forests. 2023; 14(11): 2275. <a class="reference external" href="https://doi.org/10.3390/f14112275">https://doi.org/10.3390/f14112275</a>.</p></li>
<li><p>Busby, JR. BIOCLIM - a Bioclimate Analysis and Prediction System. <a class="reference external" href="https://caws.org.nz/PPQ567/PPQ%2006-1%20pp008-9%20Busby.pdf">https://caws.org.nz/PPQ567/PPQ 06-1 pp008-9 Busby.pdf</a>.</p></li>
<li><p>Tôrres NM, De Marco Júnior P, Santos T, Silveira L, de Almeida Jácomo AT and Diniz-Filho JAF. Can Species Distribution Modelling Provide Estimates of Population Densities? A Case Study with Jaguars in the Neotropics. Diversity and Distributions. 2012; 18(6): 615-627. <a class="reference external" href="https://doi.org/10.1111/j.1472-4642.2012.00892.x">https://doi.org/10.1111/j.1472-4642.2012.00892.x</a>.</p></li>
<li><p>Budic L, Didenko G and Dormann CF. Squares of Different Sizes: Effect of Geographical Projection on Model Parameter Estimates in Species Distribution Modeling. Ecol Evol. 2016; 6(1): 202-211. <a class="reference external" href="https://doi.org/10.1002/ece3.1838">https://doi.org/10.1002/ece3.1838</a>.</p></li>
<li><p>ESRI. <em>World Continents [Web Map]</em>. Scale Not Given. <a class="reference external" href="https://hub.arcgis.com/datasets/esri::world-continents/about">https://hub.arcgis.com/datasets/esri::world-continents/about</a>. [Accessed 15/01/2024].</p></li>
<li><p>Beaumont LJ, Hughes L, Poulsen M. Predicting Species Distributions: Use of Climatic Parameters in Bioclim and Its Impact on Predictions of Species’ Current and Future Distributions. Ecological Modelling. 2005; 186(22): 251-270. <a class="reference external" href="https://doi.org/10.1016/j.ecolmodel.2005.01.030">https://doi.org/10.1016/j.ecolmodel.2005.01.030</a>. [Accessed 15/01/2024].</p></li>
<li><p>Kellner CJ, Brawn JD, Karr JR. What Is Habitat Suitability and How Should It Be Measured?. In: McCullough DR, Barrett RH (eds) Wildlife 2001: Populations. Springer, Dordrecht. <a class="reference external" href="https://doi.org/10.1007/978-94-011-2868-1_36">https://doi.org/10.1007/978-94-011-2868-1_36</a> [Accessed 17/01/2024].</p></li>
<li><p>Anderson CB. elapid: Species Distribution Modeling Tools for Python. Journal of Open Source Software. 2023; 8(84): 4930. <a class="reference external" href="https://doi.org/10.21105/joss.04930">https://doi.org/10.21105/joss.04930</a>.</p></li>
<li><p>Dormann CF. Effects of Incorporating Spatial Autocorrelation Into the Analysis of Species Distribution Data. Global Ecology and Biogeography. 2007; 16(2): 129-138. <a class="reference external" href="https://doi.org/10.1111/j.1466-8238.2006.00279.x">https://doi.org/10.1111/j.1466-8238.2006.00279.x</a>.</p></li>
<li><p>Steen VA, Tingley MW, Paton PWC and Elphick CS. Spatial Thinning and Class Balancing: Key Choices Lead to Variation in the Performance of Species Distribution Models With Citizen Science Data. Methods Ecol Evol. 2021; 12(2): 216–226. <a class="reference external" href="https://doi.org/10.1111/2041-210X.13525">https://doi.org/10.1111/2041-210X.13525</a>.</p></li>
<li><p>Lissovsky AA, Dudov SV. Species-Distribution Modeling: Advantages and Limitations of Its Application. 2. MaxEnt. Biol Bull Rev. 2021; 11(3): 265–275. <a class="reference external" href="https://doi.org/10.1134/S2079086421030087">https://doi.org/10.1134/S2079086421030087</a>.</p></li>
<li><p>Brown JL, Bennett JR and French CM. SDMtoolbox Technical Info. <a class="reference external" href="http://www.sdmtoolbox.org/technical-info">http://www.sdmtoolbox.org/technical-info</a> [Accessed 22/01/2024].</p></li>
<li><p>Phillips SJ, Dudík M, Elith J, Graham CH, Lehmann A, Leathwick J and Ferrier S. Sample Selection Bias and Presence-Only Distribution Models: Implications for Background and Pseudo-Absence Data. Ecological Applications. 2009; 19(1): 181-197. <a class="reference external" href="https://doi.org/10.1890/07-2153.1">https://doi.org/10.1890/07-2153.1</a>.</p></li>
<li><p>Valavi R, Elith J, Lahoz-Monfort JJ and Guillera-Arroita G. Modelling Species Presence-Only Data With Random Forests. Ecography. 2021; 44(12): 1731-1742. <a class="reference external" href="https://doi.org/10.1111/ecog.05615">https://doi.org/10.1111/ecog.05615</a>.</p></li>
<li><p>Anderson R and Gonzalez I. Species-Specific Tuning Increases Robustness to Sampling Bias in Models of Species Distributions: An Implementation With MAXENT. Ecological Modelling. 2011; 222(15): 2796-2811. <a class="reference external" href="https://doi.org/10.1016/j.ecolmodel.2011.04.011">https://doi.org/10.1016/j.ecolmodel.2011.04.011</a>.</p></li>
<li><p>Lee-Yaw JA, McCune JL, Pironon S and Sheth SN. Species Distribution Models Rarely Predict the Biology of Real Populations. Ecography. 2022; 2022(6): e05877. <a class="reference external" href="https://doi.org/10.1111/ecog.05877">https://doi.org/10.1111/ecog.05877</a>.</p></li>
<li><p>Phillips SJ, Anderson RP and Schapire RE. Maximum Entropy Modeling of Species Geographic Distributions. Ecological Modelling. 2006; 190(3): 231-259. <a class="reference external" href="https://doi.org/10.1016/j.ecolmodel.2005.03.026">https://doi.org/10.1016/j.ecolmodel.2005.03.026</a>.</p></li>
<li><p>Booth TH, Nix HA, Busby JR and Hutchinson MF. Bioclim: The First Species Distribution Modelling Package, Its Early Applications and Relevance to Most Current MAXENT Studies. Diversity Distrib. 2014; 20(1): 1-9. <a class="reference external" href="https://doi.org/10.1111/ddi.12144">https://doi.org/10.1111/ddi.12144</a>.</p></li>
<li><p>Fick SE and Hijmans RJ.  WorldClim 2: New 1-Km Spatial Resolution Climate Surfaces for Global Land Areas. Int. J. Climatol. 2017; 37(12); 4302-4315. <a class="reference external" href="https://doi.org/10.1002/joc.5086">https://doi.org/10.1002/joc.5086</a>.</p></li>
<li><p>Franklin J. Mapping Species Distributions: Spatial Inference and Prediction. Cambridge University Press; 2010.</p></li>
<li><p>Freeman, E. A., and G. Moisen. 2008. “PresenceAbsence: An R Package for Presence Absence Analysis.” Journal of Statistical Software. 2008; 23(11): 1–31. <a class="reference external" href="https://doi.org/10.18637/jss.v023.i11">https://doi.org/10.18637/jss.v023.i11</a>.</p></li>
<li><p>Hijmans RJ. Raster: Geographic Data Analysis and Modeling. <a class="reference external" href="https://CRAN.R-project.org/package=raster">https://CRAN.R-project.org/package=raster</a>.</p></li>
<li><p>Naimi B and Araújo MB. SDM: A Reproducible and Extensible R Platform for Species Distribution Modelling. Ecography. 2016; 39(4): 368-375. <a class="reference external" href="https://doi.org/10.1111/ecog.01881">https://doi.org/10.1111/ecog.01881</a>.</p></li>
<li><p>Quigley H, Foster R, Petracca L, Payan E, Salom R and Harmsen B. Panthera onca (errata version published in 2018). The IUCN Red List of Threatened Species 2017: e.T15953A123791436. <a class="reference external" href="https://dx.doi.org/10.2305/IUCN.UK.2017-3.RLTS.T15953A50658693.en">https://dx.doi.org/10.2305/IUCN.UK.2017-3.RLTS.T15953A50658693.en</a>. [Accessed 01/02/2024].</p></li>
<li><p>Leach K, Montgomery IW and Reid N. Modelling the Influence of Biotic Factors on Species Distribution Patterns. Ecological Modelling. 2016; 337: 96-106.<a class="reference external" href="https://doi.org/10.1016/j.ecolmodel.2016.06.008">https://doi.org/10.1016/j.ecolmodel.2016.06.008</a>.</p></li>
<li><p>Zizka A, Silvestro D, Andermann T, Azevedo J, Duarte Ritter C et al. CoordinateCleaner: Standardized Cleaning of Occurrence Records From Biological Collection Databases. Methods in Ecology and Evolution. 2019; 10(5): 744-751, <a class="reference external" href="https://doi.org/10.1111/2041-210X.13152">https://doi.org/10.1111/2041-210X.13152</a>.</p></li>
<li><p><a class="reference external" href="http://GBIF.org">GBIF.org</a>. Data Quality Requirements: Occurrence Datasets. <a class="reference external" href="https://www.gbif.org/data-quality-requirements-occurrences">https://www.gbif.org/data-quality-requirements-occurrences</a> [Accessed 01/02/2024].</p></li>
<li><p>Waller J. Common Things to Look out for When Post-processing GBIF Downloads. <a class="reference external" href="http://GBIF.org">GBIF.org</a>. <a class="reference external" href="https://data-blog.gbif.org/post/gbif-filtering-guide/">https://data-blog.gbif.org/post/gbif-filtering-guide/</a> [Accessed 01/02/2024].</p></li>
<li><p>de Oliveira G, Rangel TF, Lima-Ribeiro MS, Terribile LC and Diniz-Filho JAF. Evaluating, Partitioning, and Mapping the Spatial Autocorrelation Component in Ecological Niche Modeling: A New Approach Based on Environmentally Equidistant Records. Ecography. 2014; 37(7): 637-647. <a class="reference external" href="https://doi.org/10.1111/j.1600-0587.2013.00564.x">https://doi.org/10.1111/j.1600-0587.2013.00564.x</a>.</p></li>
<li><p>Valavi R, Elith J, Lahoz-Monfort JJ and Guillera-Arroita G. blockCV: An R Package for Generating Spatially or Environmentally Separated Folds for K-Fold Cross-Validation of Species Distribution Models. Methods Ecol Evol. 2019; 10(2): 225–232. <a class="reference external" href="https://doi.org/10.1111/2041-210X.13107">https://doi.org/10.1111/2041-210X.13107</a>.</p></li>
<li><p>Peterson AT, et al. Ecological Niches and Geographic Distributions (MPB-49). Princeton University Press, 2011. JSTOR, <a class="reference external" href="http://www.jstor.org/stable/j.ctt7stnh">http://www.jstor.org/stable/j.ctt7stnh</a>.</p></li>
<li><p>Pearce JL and Boyce MS. Modelling Distribution and Abundance With Presence-Only Data. Journal of Applied Ecology. 2006; 43(3): 405-412. <a class="reference external" href="https://doi.org/10.1111/j.1365-2664.2005.01112.x">https://doi.org/10.1111/j.1365-2664.2005.01112.x</a>.</p></li>
<li><p>Allouche O, Tsoar A and Kadmon R. Assessing the Accuracy of Species Distribution Models: Prevalence, Kappa and the True Skill Statistic (TSS). Journal of Applied Ecology. 2006; 43(6): 1223-1232. <a class="reference external" href="https://doi.org/10.1111/j.1365-2664.2006.01214.x">https://doi.org/10.1111/j.1365-2664.2006.01214.x</a>.</p></li>
<li><p>Baker DJ, Maclean IMD and Gaston KJ. Effective Strategies for Correcting Spatial Sampling Bias in Species Distribution Models Without Independent Test Data. Diversity and Distributions. 2023; 1–13. <a class="reference external" href="https://doi.org/10.1111/ddi.13802">https://doi.org/10.1111/ddi.13802</a>.</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-data-and-packages">Import data and packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods">Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#study-area">Study area</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#panthera-onca-occurrence-data">Panthera onca occurrence data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reprojection">Reprojection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-autocorrelation">Spatial autocorrelation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#climate-and-elevation-data">Climate and elevation data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#covariate-histograms">Covariate histograms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">Feature selection</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#features-with-major-disconituities">Features with major disconituities</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pca-analysis">PCA analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collinearity-analysis">Collinearity analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#environmental-envelope">Environmental envelope</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#oneclasssvm-presence-background-models">OneClassSVM &amp; presence-background models</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-and-conclusions">Discussion and Conclusions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tom Whitehouse
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>